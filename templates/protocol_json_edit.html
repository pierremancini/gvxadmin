{% extends 'admin/model/edit.html' %}

{% block tail %}
  {{ super() }}

    <link rel="stylesheet" href="{{ url_for('static', filename='code/css/jsoneditor.css') }}">

    <style type="text/css">

      div.jsoneditor {
        // Override css du jsoneditor pour avoir une fenetre scrollable.
        color: #1A1A1A;
        border: 1px solid #3883fa;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        width: 100%;
        height: 500px;
        position: relative;
        padding: 0;
        line-height: 100%;
      }

    </style>

    <script src="{{ url_for('static', filename='code/js/jsoneditor.js') }}"></script>

    <script>

      var schema;
      var group;

      $.ajax({
        url: "{{ url_for('static', filename='code/js/schema/config_schema.json') }}",
        dataType: 'json',
        async: false,
        success: function(data) {
          schema = data;
        }
      });

      function updateConfigField() {
        document.getElementById('config_json').value = editor.getText();
      }

      var options = {
        schema: schema,
        onChange: updateConfigField
      };

      var container = document.getElementById('config_json').parentNode;

      var json = JSON.parse(document.getElementById('config_json').value);

      var editor = new JSONEditor(container, options, json);
      editor.setName('Config JSON');

      document.getElementById('config_json').addEventListener('keyup', updateEditor);

      function updateEditor() {

        editor.set(JSON.parse(document.getElementById('config_json').value));

      }

    </script>

{% endblock %}

